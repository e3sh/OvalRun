function GameObj_GradeUpItem(){let t;this.triggerDelay=0,this.mode=0,this.blink=!0,this.barth=!0,this.spriteItem,this.init=function(e){this.triggerDelay=e.time()+250,this.mode=0,this.barth=!0,this.spriteItem.mode=this.mode,this.spriteItem.blink=!0,t=!1,this.spriteItem.normalDrawEnable=!0,this.spriteItem.moveFunc=function(t){let e=t/(1e3/60);this.alive--,this.x+=this.vx*e,this.y+=this.vy*e}},this.step=function(e,i,s){if(this.spriteItem.collisionEnable=!this.barth,this.spriteItem.living?(this.triggerDelay<e.time()&&(this.triggerDelay=e.time()+250,this.mode=this.spriteItem.mode!=this.mode?this.spriteItem.mode:this.mode,this.spriteItem.priority=this.mode,this.blink=!this.blink,this.spriteItem.blink=this.blink,this.barth=!1),t=!1):t||(t=!0),t)return;const n=this.spriteItem.x,r=this.spriteItem.y;this.spriteItem.r;n<32&&(this.spriteItem.x=32),n>1568&&(this.spriteItem.x=1568),r<32&&(this.spriteItem.y=32),r>928&&(this.spriteItem.y=928)},this.draw=function(t){this.spriteItem.living&&this.spriteItem.view()}}function GameObjectEnemy(t){const e=t;this.r=0,this.vr=0,this.x=0,this.y=0,this.vx=0,this.vy=0,this.old_X=0,this.old_y=0,this.triggerDelay=0,this.op={ptr:0,x:Array(40),y:Array(40),r:Array(40)},this.turlet=new function(){const t=e.CHECKPOINT_MAP;let i=function(t){return t.CHECKPOINT_MAP[3]}(e),s=0,n=[];function r(t,e){return Math.sqrt(Math.abs(e.x-t.x)*Math.abs(e.x-t.x)+Math.abs(e.y-t.y)*Math.abs(e.y-t.y))}this.vecToR=function(t,e){return(270+(0==t?e>=0?180:0:Math.atan(e/t)*(180/Math.PI)+(t>=0?90:270)))%360},this.check=function(t){s=(s+360)%360,t>270&&s<90&&(t-=360),s>270&&t<90&&(t+=360);let e=Math.trunc(180+t-s)%360;e>=180&&s++,e<=180&&s--,e>=210&&(s+=2),e<=150&&(s-=2),e>=270&&(s+=3),e<=90&&(s-=3)},this.move=function(t){s=(s+t)%360},this.vector=function(){return s},this.gcheck=function(t,e,s){this.check(function(t,e,s){const n=i;let h=9999,o=-1;for(let t in n){let i=r({x:e,y:s},{x:n[0],y:n[1]});i<=h&&(o=t,h=i)}let a=-1;return-1!=o&&(a=vecToR(e-n[o].x,s-n[o].y)),(a+180)%360}(0,e,s))},this.gdist=function(e,s,h){let o=!1;n=[];for(let i in t){let a=t[i][e];r({x:s,y:h},{x:a[0],y:a[1]})<10?(n.push(!0),o=!0):n.push(!1)}return r({x:s,y:h},{x:i[e][0],y:i[e][1]})},this.guideset=function(t,e,s){return(this.vecToR(e-i[t][0],s-i[t][1])+180)%360},this.laneselect=function(e){return e<0&&(e=0),e>=t.length&&(e=t.length-1),i=t[e],e},this.bordercheck=function(e){let i=!1;if(n[0]||n[t.length-1]){i=!0;for(let e=1;e<t.length-1;e++)n[e]&&(i=!1)}return i}}(e);let i,s={speed:0,charge:0,power:0,maxspeed:0,accel:1};this.status=function(){return s},this.spriteItem;let n,r,h,o,a=!1;this.LAP=function(){return{count:r,par:n/20}},this.ResetLAP=function(){h=3,r=0},this.init=function(t,e,o){this.r=0,this.vr=0,this.x=this.spriteItem.x,this.y=this.spriteItem.y,this.old_x=this.x,this.old_y=this.y,this.triggerDelay=0,s.maxspeed=t,s.accel=e,this.spriteItem.mode=0,this.spriteItem.linkedOption=!1,i=!1,a=!1,n=0,h=o,r=0},this.step=function(t,e,l){this.spriteItem.collisionEnable=!0;let c=0,p=-1,u=e.trigger;!e.left&&e.right;u&&(this.triggerDelay<t.time()&&(this.triggerDelay=t.time()+250),c=Math.trunc(3*Math.random())-1,p=Math.trunc(3*Math.random())-1),p<0?s.speed+=.1*s.accel:s.speed-=.01,p>0&&(s.speed-=.1),s.speed>s.maxspeed&&(s.speed=s.maxspeed),s.speed<0&&(s.speed=3,this.spriteItem.collisionEnable=!1);let m=0+s.speed;h=this.turlet.laneselect(h+c),this.turlet.bordercheck(h)&&(s.speed=0),this.r=this.turlet.guideset(n,this.x,this.y);let d=m*Math.cos(Math.PI/180*this.turlet.vector()),f=m*Math.sin(Math.PI/180*this.turlet.vector()),g=!1,y=!!Boolean(this.spriteItem.wall)&&!!this.spriteItem.wall;if(this.spriteItem.living?i=!1:i||(!function(t,e,i,s=0,n=360){for(let r=s;r<n;r+=30)sp=t.sprite.itemCreate("BULLET_E",!0,8,8),sp.pos(e,i,r),sp.move(r,2,30)}(t,this.x,this.y),i=!0,a=!1,s.speed=0,this.old_x=this.x,this.old_y=this.y),g=!!y,g?(this.spriteItem.wall=!1,s.speed-=.2,o++):o=0,i)return;this.turlet.check(this.r),d=(this.old_x-this.x+d)/2,f=(this.old_y-this.y+f)/2,this.old_x=Math.trunc(this.x),this.old_y=Math.trunc(this.y);let A=t.deltaTime()/(1e3/60);this.x=this.x+d*A,this.y=this.y+f*A,this.x<32&&(this.x=32),this.x>1568&&(this.x=1568),this.y<32&&(this.y=32),this.y>928&&(this.y=928),this.turlet.gdist(n,this.x,this.y)<60&&(s.speed-=.5,n++,n%=21,0==n&&r++)},this.draw=function(t){let e=Math.trunc(this.x),i=Math.trunc(this.y);this.spriteItem.pos(e,i,(this.turlet.vector()+90)%360,1),this.spriteItem.view()}}function GameObjectPlayer(t){const e=t;this.r=0,this.vr=0,this.x=0,this.y=0,this.vx=0,this.vy=0,this.old_X=0,this.old_y=0,this.triggerDelay=0,this.stickDelay=0,this.op={ptr:0,x:Array(40),y:Array(40),r:Array(40)},this.turlet=new function(){const t=e.CHECKPOINT_MAP;let i=function(t){return t.CHECKPOINT_MAP[3]}(e),s=0,n=[];function r(t,e){return Math.sqrt(Math.abs(e.x-t.x)*Math.abs(e.x-t.x)+Math.abs(e.y-t.y)*Math.abs(e.y-t.y))}this.vecToR=function(t,e){return(270+(0==t?e>=0?180:0:Math.atan(e/t)*(180/Math.PI)+(t>=0?90:270)))%360},this.check=function(t){s=(s+360)%360,t>270&&s<90&&(t-=360),s>270&&t<90&&(t+=360);let e=Math.trunc(180+t-s)%360;e>=180&&s++,e<=180&&s--,e>=210&&(s+=2),e<=150&&(s-=2),e>=270&&(s+=3),e<=90&&(s-=3)},this.move=function(t){s=(s+t)%360},this.vector=function(){return s},this.gcheck=function(t,e,s){this.check(function(t,e,s){const n=i;let h=9999,o=-1;for(let t in n){let i=r({x:e,y:s},{x:n[0],y:n[1]});i<=h&&(o=t,h=i)}let a=-1;return-1!=o&&(a=vecToR(e-n[o].x,s-n[o].y)),(a+180)%360}(0,e,s))},this.gdist=function(e,s,h){let o=!1;n=[];for(let i in t){let a=t[i][e];r({x:s,y:h},{x:a[0],y:a[1]})<10?(n.push(!0),o=!0):n.push(!1)}return r({x:s,y:h},{x:i[e][0],y:i[e][1]})},this.guideset=function(t,e,s){return(this.vecToR(e-i[t][0],s-i[t][1])+180)%360},this.laneselect=function(e){return e<0&&(e=0),e>=t.length&&(e=t.length-1),i=t[e],e},this.bordercheck=function(e){let i=!1;if(n[0]||n[t.length-1]){i=!0;for(let e=1;e<t.length-1;e++)n[e]&&(i=!1)}return i}};let i,n={speed:0,charge:0,power:0};this.status=function(){return n},this.spriteItem;let r,h,o,a,l,c,p,u,m,d,f=!1;this.LAP=function(){return{count:u,par:a/20}},this.ResetLAP=function(){p=[],m=3,u=0},this.init=function(t){this.r=0,this.vr=0,this.x=this.spriteItem.x,this.y=this.spriteItem.y,this.old_x=this.x,this.old_y=this.y,this.triggerDelay=0,this.stickDelay=0,this.spriteItem.mode=0,this.spriteItem.linkedOption=!1,i=!1,f=!1,h=t.beep.makeScore(["C3"],250,.3),a=0,l=[],c=t.time(),p=[];m=3,u=0},this.setNote=function(t){r=t,o=0},this.step=function(t,e,g){this.spriteItem.collisionEnable=!0;let y=e.y,A=e.trigger,x=e.left?-1:e.right?1:0;if(A&&this.triggerDelay<t.time()&&(this.triggerDelay=t.time()+250,this.spriteItem.living)){let e=t.sprite.itemCreate(f?"BULLET_P2":"BULLET_P",!0,8,8),i=this.turlet.vector(),n=this.x+16*Math.cos(Math.PI/180*i),h=this.y+16*Math.sin(Math.PI/180*i);e.pos(n,h,0,.6),e.move((i+90)%360,16,120),score=["E5","C5"],s=t.beep.makeScore(score,50,.5),r.play(s,t.time())}y<0?n.speed+=.1:n.speed-=.01,y>0&&(n.speed-=.1),n.speed>30&&(n.speed=30),n.speed<0&&(n.speed=3);let I=0+n.speed;this.stickDelay<t.time()&&(this.stickDelay=t.time()+100,m=this.turlet.laneselect(m-x)),this.turlet.bordercheck(m)&&(n.speed=0),this.r=this.turlet.guideset(a,this.x,this.y);let w=I*Math.cos(Math.PI/180*this.turlet.vector()),b=I*Math.sin(Math.PI/180*this.turlet.vector()),v=!1,P=!!Boolean(this.spriteItem.wall)&&!!this.spriteItem.wall,B=!1;if(this.spriteItem.living?(B=!!Boolean(this.spriteItem.mode)&&0!=this.spriteItem.mode,B&&(this.spriteItem.mode,this.spriteItem.mode,this.spriteItem.mode,0!=(8&this.spriteItem.mode)&&(f=!f),this.spriteItem.mode=0),i=!1):(i||(!function(t,e,i,s=0,n=360){for(let r=s;r<n;r+=30)sp=t.sprite.itemCreate("BULLET_P",!0,8,8),sp.pos(e,i,r),sp.move(r,2,30)}(t,this.x,this.y),i=!0,f=!1,n.speed=0,w=0,b=0,a=0,l=[],this.old_x=this.x,this.old_y=this.y),n.speed=0,w=0,b=0),v=!!P,v?(this.spriteItem.wall=!1,n.speed-=.2,d++):d=0,i)return;this.turlet.check(this.r),w=(this.old_x-this.x+w)/2,b=(this.old_y-this.y+b)/2,this.old_x=this.x,this.old_y=this.y;let C=t.deltaTime()/(1e3/60);if(this.x=this.x+w*C,this.y=this.y+b*C,this.x<32&&(this.x=32),this.x>1568&&(this.x=1568),this.y<32&&(this.y=32),this.y>928&&(this.y=928),t.time()>o&&(r.busy=!1),r.busy||g.clrf)r.busy&&r.changeFreq(I/2*65);else{for(let t in h){h[t].use=!1}r.play(h,t.time()),o=t.time()+240}if(this.turlet.gdist(a,this.x,this.y)<60){n.speed-=.5,a++,a%=21,l[a]=1;let e=0;for(let t of l)e+=t;if(e>=20){l=[],p.push(Math.trunc(t.time()-c)),c=t.time(),u++;const e=t.beep.makeScore(["E6"],200,.5);r.play(e,t.time())}}t.screen[0].buffer.turn(Math.trunc(270-this.turlet.vector()))},this.draw=function(t){t.font.std.putchr(m+"Ln "+Math.trunc(t.time()-c)/1e3,0,232);for(let e in p){t.font.std.putchr(""+p[e]/1e3,24,248+8*e)}let e=this.x,i=this.y;this.spriteItem.pos(e,i,Math.trunc(this.turlet.vector()+90)%360,1),this.spriteItem.view()}}function SceneGame(){let t,e,i,n,r,h,o,a,l,c,p,u;const m=new OffscreenCanvas(1600,960),d=m.getContext("2d");function f(){let t,e;this.run=function(){t++},this.set=function(){e=0,t=0},this.check=function(){return t!=e}}this.state=function(){return{ene:a,result:i,time:h,stage:i.stage,score:i.score,delay:n,block:undefined,collision:0,sprite:e.length,clear:i.clrf,gameover:i.govf,dead:i.dedf,status:o.status(),laplist:u}},this.init=function(i){l=new f,t=[],c=new StageControl(i),c.init(),e=i.sprite.itemList(),p=[],i.beep.oscSetup(1),i.beep.lfoReset(),p[0]=i.beep.createNote(1),i.beep.oscSetup(0),i.beep.lfoSetup(10,0,50),p[1]=i.beep.createNote(1),i.beep.oscSetup(1),i.beep.lfoSetup(24,3,20),p[2]=i.beep.createNote(1);for(let t of p)t.on(0);this.reset(i)},this.reset=function(s){c.init(),t=[],s.sprite.itemFlash(),o=new GameObjectPlayer(s),o.spriteItem=s.sprite.itemCreate("Player",!0,28,28),o.spriteItem.pos(640,180),o.init(s),o.setNote(p[1]),t.push(o),c.change(1,t);for(let t in this.spriteTable)e[t].visible=!1;a={now:3,max:3,before:this.now},i={score:0,time:s.time(),stage:1,clrf:!1,govf:!1,dedf:!1},n=0,r=0,s.screen[0].buffer._2DEF(!0),s.screen[0].buffer.turn(0)},this.step=function(r,f,g){h=Math.trunc((r.time()-i.time)/100),r.viewport.setPos(Math.trunc(320-o.x),Math.trunc(240-o.y)),u=[];for(let e of t)if(e.step(r,f,i),e.spriteItem.living&&Boolean(e.LAP)){let t=e.LAP();u.push(t)}if(n<r.time()){n=r.time()+500,a.before=a.now,r.sprite.itemIndexRefresh();let e=0,s=r.sprite.itemList();for(let t of s)"Enemy"==t.id&&e++;let h=!1,l=!1;for(let t of u)t.count>4&&(l=!0);if(l&&(u[0].count>4?e=0:h=!0),!o.spriteItem.living)if(i.dedf){if(a.now>0){o.spriteItem=r.sprite.itemCreate("Player",!0,24,24),o.spriteItem.pos(640,180),o.x=640,o.y=180,o.vx=0,o.vy=0,o.old_x=640,o.old_y=180,o.r=0;let t=["G4","C5","E4","C4","A3"],e=r.beep.makeScore(t,100,1);p[0].play(e,r.time())}i.dedf=!1;let e=r.sprite.itemList();for(let t of e)"Enemy"==t.id.substring(0,8)&&t.dispose();c.change(i.stage,t)}else a.now--,i.dedf=!0,n=r.time()+1500;if(i.score>=5e3*(a.max-2)){const t=r.sprite.itemCreate("BULLET_P",!1,1,1);t.priority=5,t.normalDrawEnable=!1,t.customDraw=function(t,e){t.viewport.viewtoReal(this.x-28,this.y);t.screen[1].fill(292,200,48,8,"Black"),t.font.std.putchr("Extend.",296,200)},t.moveFunc=function(t){this.alive--,this.alive<=0?this.visible=!1:this.visible=!0},t.pos(o.x,o.y),t.move(0,0,60),a.now++,a.max++;let e=["G5","C6","E6","C6","D6","G6"],i=r.beep.makeScore(e,100,1);p[0].play(i,r.time())}if(0==e)if(i.clrf){i.time=r.time(),i.stage++;let e=[];for(let i in t)t[i].spriteItem.living&&("Enemy"==t[i].spriteItem.id&&t[i].ResetLAP(),e.push(t[i]));t=e,o.ResetLAP(),c.change(i.stage,t);let s=r.sprite.itemList();for(let t of s)"BULLET_P"==t.id.substring(0,8)&&t.dispose(),"BULLET_E"==t.id.substring(0,8)&&t.dispose()}else{i.clrf=!0,n=r.time()+3e3;let t=["G4","C5","E5","G5","G5"],e=r.beep.makeScore(t,100,1);p[0].play(e,r.time())}else i.clrf=!1;if(a.now<=0||h){n=r.time()+3e3,h||(a.now=0),i.govf=!0;let t=["F4","E4","D4","C4","B3","B#3","C4"],e=r.beep.makeScore(t,150,1);p[0].play(e,r.time())}}var y;d.clearRect(0,0,m.width,m.height),(y=d).beginPath(),y.globalAlpha=1,y.strokeStyle="gray",y.lineWidth=12,y.arc(112,48,30,.5*Math.PI,1.5*Math.PI,!0),y.arc(48,48,30,1.5*Math.PI,.5*Math.PI,!0),y.moveTo(112,78),y.lineTo(48,78),y.stroke(),r.sprite.CollisionCheck(),e=r.sprite.itemList();for(let n in e){let h=e[n];if(h.living&&(h.collisionEnable&&h.visible)){if("Player"==h.id){let t=h.hit;for(let e in t){let n=t[e];n.visible&&("Enemy"==n.id&&(h.dispose(),n.dispose(),score=["E4","D4","C4","B3"],s=r.beep.makeScore(score,50,1),p[2].play(s,r.time())),"Player"==h.id&&"POWERUP"==n.id&&(n.mode>0&&(Boolean(h.mode)&&isNaN(h.mode)?h.mode+=Math.pow(2,n.mode-1):h.mode=Math.pow(2,n.mode-1)),i.score+=0==n.mode?300:0,n.dispose(),score=["C6","C5"],s=r.beep.makeScore(score,50,1),p[0].play(s,r.time())))}d.beginPath(),d.fillStyle="yellow";let e=Math.trunc(r.time()/250)%2==0?2:1;d.fillRect(Math.trunc(h.x/10)-e,Math.trunc(h.y/10)-e,e+3,e+3)}if("Enemy"==h.id){let e=h.hit;for(let n in e){let o=e[n];if(o.visible&&"BULLET_P"==o.id.substring(0,8)){let e=new GameObj_GradeUpItem;e.spriteItem=r.sprite.itemCreate("POWERUP",!1,28,16),e.spriteItem.pos(h.x,h.y,0,.5),e.init(r),t.push(e),h.dispose(),o.dispose(),i.score+=10,score=["A3","A2"],s=r.beep.makeScore(score,50,1),p[2].play(s,r.time());break}}d.beginPath(),d.fillStyle="red",d.fillRect(Math.trunc(h.x/10)-1,Math.trunc(h.y/10)-1,3,3)}}}!function(t){for(let e in t){let i=t[e];(i.x<0||i.x>1600||i.y<0||i.y>960)&&((i.x<0||i.x>1600)&&i.dispose(),(i.y<0||i.y>960)&&i.dispose())}}(r.sprite.itemList()),c.step(r,f,i),l.run()},this.draw=function(e){l.check();c.draw(e);const s=e.viewport.viewtoReal;if(1){let t=e.sprite.itemList();for(let i in t)if("BULLET"==t[i].id.substring(0,6)){let n=s(t[i].x,t[i].y),r=n.x,h=n.y;n.in&&e.screen[0].fill(r-t[i].collision.w/2,h-t[i].collision.h/2,t[i].collision.w,t[i].collision.h,"BROWN")}}if(!i.govf)for(let i of t)i.draw(e);e.screen[1].putImage(m,480,330),l.set()}}class GameTask_Main extends GameTask{_x=0;_y=0;_sm={};_dtt=0;_result;_titlef;titlewait;_wh=0;scene;_dv;note;constructor(t){super(t)}pre(t){this.scene=[],this.scene.Game=new SceneGame,this.scene.UI=new SceneGameUI,this.scene.Debug=new SceneDebug,this.scene.Result=new SceneResult,this.scene.GameOver=new SceneGameOver,this.scene.Title=new SceneTitle,this.scene.Gpad=new SceneGPad,this.scene.VGpad=new SceneVGPad,t.sprite.useScreen(0),t.font.std.useScreen(1),t.sprite.setPattern("Player",{image:"SPGraph",wait:0,pattern:[{x:0,y:0,w:32,h:32,r:0,fv:!1,fh:!1}]}),t.sprite.setPattern("BULLET_P",{image:"SPGraph",wait:0,pattern:[{x:48,y:48,w:8,h:32,r:0,fv:!1,fh:!1}]}),t.sprite.setPattern("BULLET_P2",{image:"SPGraph",wait:0,pattern:[{x:16,y:16,w:8,h:32,r:0,fv:!1,fh:!1}]}),t.sprite.setPattern("BULLET_P3",{image:"SPGraph",wait:0,pattern:[{x:48,y:48,w:8,h:8,r:0,fv:!1,fh:!1}]}),t.sprite.setPattern("Enemy",{image:"SPGraph",wait:0,pattern:[{x:0,y:32,w:32,h:32,r:0,fv:!1,fh:!1}]}),t.sprite.setPattern("BULLET_E",{image:"SPGraph",wait:0,pattern:[{x:48,y:48,w:4,h:16,r:0,fv:!1,fh:!1}]}),t.sprite.setPattern("POWERUP",{image:"SPGraph",wait:0,pattern:[{x:32,y:32,w:32,h:32,r:0,fv:!1,fh:!1}]}),this.scene.Game.init(t),this._initGame(t),this._sm={x:0,y:0,old_x:0,old_y:0},t.beep.oscSetup(1),t.beep.lfoReset(),this.note=t.beep.createNote(1),this.note.on(0);let e=t.beep.makeScore(["C5","C6"],100,.1);this.note.play(e,t.time()+250)}_initGame(t){this.scene.Game.reset(t),this._titlef=!0,this.titlewait=t.time()+1e3}step(t){let e=t.keyboard.check(),i=!1;Boolean(e[65])&&e[65]&&(i=!0);let s=!1;Boolean(e[68])&&e[68]&&(s=!0);let n=!1;Boolean(e[87])&&e[87]&&(n=!0);let r=!1;Boolean(e[83])&&e[83]&&(r=!0);let h=!1;Boolean(e[81])&&e[81]&&(h=!0);let o=!1;Boolean(e[69])&&e[69]&&(o=!0);let a=!1;Boolean(e[38])&&e[38]&&(a=!0);let l=!1;Boolean(e[40])&&e[40]&&(l=!0);let c=!1;Boolean(e[37])&&e[37]&&(c=!0);let p=!1;Boolean(e[39])&&e[39]&&(p=!0);let u=!1;Boolean(e[32])&&e[32]&&(u=!0);let m=!1;Boolean(e[90])&&e[90]&&(m=!0);let d=!1;Boolean(e[36])&&e[36]&&(d=!0);let f=!1;Boolean(e[80])&&e[80]&&(f=!0);let g=t.gamepad.check(),y=t.gamepad.btn_lb,A=t.gamepad.btn_rb,x=t.gamepad.btn_a,I=t.gamepad.btn_x,w=t.gamepad.btn_back,b=t.gamepad.r,v=t.gamepad.axes;a=!(!a&&!n),l=!(!l&&!r),c=!(!c&&!i),p=!(!p&&!s),!(!d&&!w)&&(document.fullscreenElement||t.systemCanvas.requestFullscreen());let P=t.vgamepad.check(),B=!1;Boolean(P.button[0])&&P.button[0]&&(B=!0);let C=!1;Boolean(P.button[1])&&P.button[1]&&(C=!0);let S=!1;Boolean(P.button[2])&&P.button[2]&&(S=!0);let M=!1;if(Boolean(P.button[3])&&P.button[3]&&(M=!0),g&&-1!=b)this._x=v[0],this._y=v[1];else if(-1!=P.distance){let t=(P.deg-90)*(Math.PI/180);this._x=Math.cos(t),this._y=Math.sin(t)}else this._x=c?-1:p?1:0,this._y=a?-1:l?1:0;let k=y||m||h||B,E=A||m||o||C,G=x||I||u||M,T={x:this._x,y:this._y,trigger:G,left:k,right:E,keycode:e},L=this.scene.Game.state();if(this._result=L.result,this._titlef){if(L.block=0,L.sprite=0,this.scene.Title.step(t,T,{delay:this.titlewait})){this._titlef=!1;let e=["C4","C3","C4","G4","A0","C5"],i=t.beep.makeScore(e,150,1);this.note.play(i,t.time())}}else L.gameover?this.scene.GameOver.step(t,T,L)&&this._initGame(t):this.scene.Game.step(t,T);this._result.clrf&&this.scene.Result.step(t,T),this.scene.UI.step(t,T,L),this.scene.Debug.step(t,T,L),this._dv=!!f,this._dv&&this.scene.Gpad.step(t,T,L),this.scene.VGpad.step(t,T,L)}draw(t){this._titlef||this.scene.Game.draw(t),this._titlef||this.scene.UI.draw(t),this._dv&&this.scene.Debug.draw(t),this._result.clrf&&this.scene.Result.draw(t),this._result.govf&&this.scene.GameOver.draw(t),this._titlef&&this.scene.Title.draw(t),this._dv&&this.scene.Gpad.draw(t),this.scene.VGpad.draw(t)}}function main(){const t=new GameCore({canvasId:"layer0",screen:[{resolution:{w:640,h:480,x:0,y:0}},{resolution:{w:640,h:480,x:0,y:0}}]});pictdata(t);const e=SpriteFontData();for(let i in e)t.setSpFont(e[i]);t.task.add(new GameTask_Main("main")),t.screen[0].setBackgroundcolor("black"),t.screen[0].setInterval(1),t.viewport=new viewport,t.viewport.size(640,480),t.viewport.border(320,240),t.viewport.repeat(!1),t.run()}function SpriteFontData(){let t=[];for(let e=0;e<7;e++)for(j=0;j<16;j++)ptn={x:12*j,y:16*e,w:12,h:16},t.push(ptn);let e=[],i=["white","red","green","blue"];for(let t=0;t<=3;t++){let s=[];for(let t=0;t<7;t++)for(let e=0;e<16;e++)ptn={x:6*e,y:8*t+16,w:6,h:8},s.push(ptn);e[i[t]]=s}return[{name:"std",id:"ASCII",pattern:e.white},{name:"8x8red",id:"ASCII",pattern:e.red},{name:"8x8green",id:"ASCII",pattern:e.green},{name:"8x8blue",id:"ASCII",pattern:e.blue},{name:"8x8white",id:"ASCII",pattern:e.white}]}function pictdata(t){t.asset.imageLoad("ASCII","data:image/png;base64,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"),t.asset.imageLoad("SPGraph","data:image/png;base64,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")}function SceneGameUI(){let t,e,i,s,n,r,h;this.step=function(o,a,l){t=l.ene,e=l.result,i=l.time,s=l.status.speed,n=l.laplist,r=!1,h=!1;for(let t in n)n[t].count>3&&(r=!0),n[0].count+n[0].par<n[t].count+n[t].par&&(h=!0)},this.draw=function(i){let o="";for(let e=1;e<t.now;e++)o+="A";i.font.std.putchr("PLAYER:"+o,0,448),i.font.std.putchr("STAGE :"+e.stage+" SCORE:"+Math.trunc(e.score),0,456),i.screen[1].fill(0,240,16,200,"yellowgreen"),i.screen[1].fill(1,241,14,198-s/30*198,"black"),i.font.std.putchr(Math.trunc(s)+" ",4,432);const a=200;let l=0;Boolean(n)&&(i.screen[1].fill(520,a,80,8*n.length,"black"),Boolean(n[0])&&(l=n[0].count+n[0].par));for(let t in n){const e=0==t?"PLAYER":"ENEMY ";i.screen[1].fill(560,a+8*t+6-n[t].count,38*n[t].par,1+n[t].count,l<n[t].count+n[t].par?"red":"limegreen"),i.font.std.putchr(e+" LAP:"+n[t].count,520,a+8*t)}r&&Math.trunc(i.time()/333)%2==0&&(i.screen[1].fill(290,184,66,8,h?"red":"black"),i.font.std.putchr("FINAL LAP",296,184))}}function SceneResult(){this.step=function(t,e){},this.draw=function(t){t.screen[1].fill(211,152,198,24,"black"),t.font.std.putchr("STAGE CLEAR",220,164,3),t.font.std.putchr("STAGE CLEAR",320,464)}}function SceneTitle(){let t;const e=["Thema  Spin/Roll (Donichi thread16)","","     OVAL RUN","","","","","","           START SPACE KEY","                     or GamePad Button X/A","","","","[Method of Operation]","STEERING  : Q,E or GamePad Button L/R","ACCELE    : W key or GamePad LeftAnalogStick UP","BLAKE     : S key or GamePad LeftAnalogStick DOWN","SHOT      : SPACE key or GamePad Button X/A"];this.step=function(e,i,s){t=i,delay=s.delay-e.time()<0;let n=!1;return delay&&i.trigger&&(n=!0),n},this.draw=function(t){for(let i in e)t.font.std.putchr(e[i],160,140+8*i)}}function SceneGameOver(){let t,e,i;this.step=function(s,n,r){if(t=r.stage,e=Math.trunc(r.score),i=r.delay-s.time()<0,i&&(s.sprite.itemFlash(),n.trigger))return!0},this.draw=function(t){t.screen[1].fill(208,152,216,32,"black"),t.font.std.putchr("GAME OVER",220,168,4),t.font.std.putchr(":"+(i?"OK":"WAIT"),320,456)}}function SceneDebug(){let t,e,i,s,n;this.step=function(r,h,o){t=o.block,e=r.deltaTime().toString().substring(0,5),i=o.collision,s=o.sprite,n=h},this.draw=function(t){t.font["8x8white"].putchr("DeltaT:"+e,540,0);let i=0!=n.x?n.x>0?"R":"L":"-",s=0!=n.y?n.y>0?"D":"U":"-",r=n.trigger?"T":"-",h=n.right?"S":"-";t.font["8x8green"].putchr("Input:"+s+":"+i+":"+r+":"+h,540,16)}}function SceneGPad(){let t;this.step=function(e,i,s){t=e.gamepad.infodraw();let n=i.keycode,r="";for(let t in n)Boolean(n[t])&&(r+="["+t+"]");t.push(""),t.push("[Keyboard]"),t.push(r)},this.draw=function(e){for(let i in t)e.font.std.putchr(t[i],0,48+8*i)}}function SceneVGPad(){let t;this.step=function(e,i,s){let n=e.vgamepad.check();t=[],t.push("state button:"+n.button),t.push("state deg   :"+n.deg),t.push("state distance:"+n.distance)},this.draw=function(e){e.vgamepad.draw(e.screen[1]);let i={draw:function(t){t.beginPath(),t.globalAlpha=1}};e.screen[1].putFunc(i);for(let e in t);}}function StageControl(t){let e;const i=new OffscreenCanvas(1600,960),s=i.getContext("2d",{alpha:!1,willReadFrequently:!0});let n=t;this.init=function(){e=1;const t=mapImageCreate(s);n.CHECKPOINT_MAP=t},this.change=function(t,i){e=t;for(let t=1;t<4;t++){let s=new GameObjectEnemy(n);s.spriteItem=n.sprite.itemCreate("Enemy",!0,28,28),s.spriteItem.pos(800-32*t,100),s.init(8+2*t+e,(15-t)/10,2+t),i.push(s),s=new GameObjectEnemy(n),s.spriteItem=n.sprite.itemCreate("Enemy",!0,28,28),s.spriteItem.pos(800-32*t,260),s.init(8+2*(t+3)+e,(15-(t+3))/10,4-t),i.push(s)}},this.step=function(t,e,i){let n=t.sprite.itemList();for(let t in n){let e=n[t],i=n[t];if(!i.living)continue;if(!i.collisionEnable)continue;if(!i.visible)continue;let r=e.collision.w,h=e.collision.h;if("Player"==e.id){let t=s.getImageData(e.x-r/2,e.y-h/2,r,h);c=0;for(let e=1;e<t.data.length;e+=4)c+=0!=t.data[e]?0:1;0!=c&&(e.wall=!0)}}},this.draw=function(t){let e=(0,t.viewport.viewtoReal)(0,0);t.screen[0].putImage(i,e.x,e.y)}}function mapImageCreate(t){t.fillStyle="blue",t.fillRect(0,0,1600,960);for(let e=0;e<1600;e+=100)t.beginPath(),t.strokeStyle="black",t.lineWidth=1,t.moveTo(e,0),t.lineTo(e,960),t.stroke();t.beginPath(),t.globalAlpha=1,t.strokeStyle="black",t.lineWidth=124,t.arc(1120,480,300,.5*Math.PI,1.5*Math.PI,!0),t.arc(480,480,300,1.5*Math.PI,.5*Math.PI,!0),t.moveTo(1120,780),t.lineTo(480,780),t.stroke(),t.beginPath(),t.globalAlpha=1,t.strokeStyle="white",t.lineWidth=120,t.arc(1120,480,300,.5*Math.PI,1.5*Math.PI,!0),t.arc(480,480,300,1.5*Math.PI,.5*Math.PI,!0),t.moveTo(1120,780),t.lineTo(480,780),t.stroke();const e=[];for(let i=-3;i<4;i++){const s=mapGuideMarkerCreate(20*i);e.push(s);let n=s.length-1;t.beginPath(),t.fillStyle="lightgray",t.globalAlpha=1,t.arc(s[n][0],s[n][1],10,0,2*Math.PI,!0),t.fill(),t.font="12px serif",t.fillStyle="Gray",t.globalAlpha=1;let r=i+3;t.fillText(""+r,s[n][0]-4,s[n][1]+4),t.beginPath(),t.strokeStyle="gray",t.lineWidth=1,t.arc(1120,480,300+20*i,.5*Math.PI,1.5*Math.PI,!0),t.arc(480,480,300+20*i,1.5*Math.PI,.5*Math.PI,!0),t.moveTo(1120,780+20*i),t.lineTo(480,780+20*i),t.stroke()}let i=e[0][e[0].length-1][0],s=e[0][e[0].length-1][1],n=e[6][e[6].length-1][0],r=e[6][e[6].length-1][1];return t.beginPath(),t.strokeStyle="darkgray",t.lineWidth=3,t.moveTo(i-60,s),t.lineTo(n-60,r),t.stroke(),e}function mapGuideMarkerCreate(t){const e=300+t,i=[];for(let t=-90;t<=90;t+=22.5){let s=1120+Math.cos(Math.PI/180*t)*e,n=480+Math.sin(Math.PI/180*t)*e;i.push([s,n])}i.push([800,480+e]);for(let t=90;t<=270;t+=22.5){let s=480+Math.cos(Math.PI/180*t)*e,n=480+Math.sin(Math.PI/180*t)*e;i.push([s,n])}return i.push([660,480-e]),i.push([800,480-e]),i}